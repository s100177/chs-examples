# 教程 9: 代理式（分布式）仿真

## 1. 场景目标

本教程旨在演示平台的核心架构：**代理式仿真**，特别是其中最基础的**分布式本地闭环控制**。

我们将构建一个由“感知”和“行动”两个智能体组成的最小化控制系统。一个感知智能体负责监控一个水库的水位，并将信息发布出去。一个本地控制智能体则根据这个水位信息，来调节下游闸门的开度，以试图将水位维持在一个目标值。

通过本示例，您将学习到：
- 代理式仿真的基本构成：感知智能体 + 控制智能体。
- 智能体之间如何通过消息总线进行解耦和通信。
- 如何构建一个分布式的、没有中央协调的本地控制回路。

## 2. 系统配置

- **`components.yml`**: 定义了两个物理组件：
  - `target_reservoir`: 我们希望控制其水位的目标水库。
  - `control_gate`: 用于调节水库出流的闸门。
- **`topology.yml`**: 定义了水流方向：`target_reservoir` -> `control_gate`。
- **`config.yml`**: 定义了仿真的总时长和时间步长。
- **`agents.yml`**: 定义了系统的“智能”部分：
  - `reservoir_twin_agent`: 一个 `DigitalTwinAgent`，负责感知 `target_reservoir` 的实时水位，并将其发布到消息总线的主题 `state/reservoir/target` 上。这是“感知”环节。
  - **`gate_control_agent` (概念)**: 这是一个本地控制智能体。它是“行动”环节，其内部逻辑（伪代码）如下：
    ```
    1. 订阅 'state/reservoir/target' 主题。
    2. 接收到水位信息后，与内部的目标水位（例如 15m）进行比较。
    3. 如果水位过高，则计算一个更大的闸门开度；如果水位过低，则计算一个更小的开度。
    4. 将计算出的开度作用于 `control_gate` 物理组件。
    ```

## 3. 预期结果

在一个包含所有组件（包括必要但无法从YAML加载的本地控制器）的完整系统中，您将观察到：
1.  `reservoir_twin_agent` 在每个时间步都会发布一次 `target_reservoir` 的当前水位。
2.  `gate_control_agent` 会根据收到的水位，持续地调整 `control_gate` 的开度。
3.  最终，`target_reservoir` 的水位会围绕着 `gate_control_agent` 内部设定的目标值（15m）附近波动，形成一个动态的闭环控制平衡。

这个示例展示了一个最纯粹的代理式系统：分布式的智能单元通过通信协作，在没有中央指挥的情况下，自发地完成了一个本地的控制任务。

---
**注意**: 与其他示例一样，由于当前框架无法从 `YAML` 加载一个可配置的、能订阅消息的本地控制智能体，本教程作为一个**设计模式**提供。`agents.yml` 中会概念性地描述 `gate_control_agent`。
