# 渠道模型比较示例

本示例演示并比较了四种用于模拟渠道水流的简化模型。

## 描述

该模拟设置了一个位于两个固定水位水库之间的单一渠道段。一个上游闸门控制流入渠道的水量。模拟从稳态开始，然后通过对上游闸门开度进行阶跃改变，来观察渠道水位的动态响应。

本示例将同一场景运行四次，每次使用不同的数学模型来描述渠道。然后将结果绘制在一起进行比较。

## 实现细节

本示例展示了一种常见的模拟工作流程：

1.  **业务流程编排**: `run_model_comparison.py` 脚本是主入口点。它负责整个业务流程的编排，包括：
    *   定义要比较的四种不同渠道模型的参数。
    *   循环执行每个场景，为每个场景创建独立的仿真环境。
    *   在所有模拟运行后，调用绘图函数将结果汇总到一张图表中。

2.  **事件注入**: 在每个仿真场景内部，我们使用 `ScenarioAgent` 来管理和注入预定义的事件。
    *   所有事件（例如，在第100秒时改变闸门开度）都被定义在 `event_scenario.yml` 文件中。
    *   `ScenarioAgent` 在仿真开始时加载此文件，并在指定的时间触发相应的事件。

这种架构将**“运行什么模拟”**的业务逻辑（在Python脚本中）与**“模拟中发生什么”**的场景事件（在YAML配置文件中）清晰地分离开来，使得代码更易于维护和扩展。

## 渠道模型

比较的四种渠道模型是：

1.  **积分模型 (`UnifiedCanal(model_type='integral')`)**: 这是最简单的模型，将渠道表示为单个水库，其中水位是净流量（流入量 - 流出量）的积分。它不考虑波的传播时间。其控制方程为：
    `dh/dt = (1/A) * (q_in - q_out)`
    其中 `h` 是水位，`A` 是表面积，`q_in` 是流入量，`q_out` 是流出量。

2.  **积分-延迟模型 (`IntegralDelayCanal`)**: 该模型在入流中增加了一个时间延迟，代表水从上游端到下游端的传播时间。出流量是入流量的延迟版本。这是模拟渠道中输送延迟的一种常用且简单的方法。其模型为：
    `q_out(t) = q_in(t - τ)`
    `dh/dt = K * (q_in(t) - q_out(t))`

3.  **积分-延迟-零点模型 (`IntegralDelayZeroCanal`)**: 这是积分-延迟模型的扩展，在传递函数中增加了一个“零点”。该项有助于更好地逼近渠道对流量变化的初始响应。出流量是延迟入流及其变化率的函数：
    `q_out(t) = q_in(t - τ) + Tz * d/dt(q_in(t - τ))`

4.  **线性水库模型 (`RiverChannel`)**: 该模型常用于河流段，将渠道表示为一系列线性水库。每个水库的出流量与蓄水量成正比。该模型可以捕捉波传播的某些扩散效应。单个段的控制方程为：
    `dS/dt = q_in - q_out`
    `S = k * q_out`
    其中 `S` 是蓄水量，`k` 是蓄水常数。

## 如何运行

要运行本示例，请从代码库的根目录执行以下命令：

```bash
python examples/canal_model/canal_model_comparison/run_model_comparison.py
```

这将运行所有四个模拟，将结果保存到当前目录的CSV文件中，并生成一个名为`model_comparison_results.png`的图表，显示不同模型的水位响应。脚本会自动调用 `event_scenario.yml` 中定义的事件。
