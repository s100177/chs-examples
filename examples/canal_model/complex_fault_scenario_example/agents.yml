# Agent definitions for the Complex Fault Scenario Example
agents:
  - id: physical_io_agent
    class: core_lib.local_agents.io.physical_io_agent.PhysicalIOAgent
    config:
      sensors_config:
        canal_1_water_level_sensor:
          obj_id: canal_1
          state_key: water_level
          topic: 'sensor/canal_1/water_level'
          noise_std: 0.05
        canal_2_water_level_sensor:
          obj_id: canal_2
          state_key: water_level
          topic: 'sensor/canal_2/water_level'
          noise_std: 0.05
      actuators_config:
        gate_1_actuator:
          obj_id: gate_1
          target_attr: opening
          topic: 'actuator/gate_1/opening'
          control_key: 'value'
        gate_2_actuator:
          obj_id: gate_2
          target_attr: opening
          topic: 'actuator/gate_2/opening'
          control_key: 'value'

  - id: scenario_agent
    class: core_lib.mission.scenario_agent.ScenarioAgent
    config:
      scenario_script:
        - time: 3600 # 1 hour in - Increase turnout 1 demand
          topic: 'disturbance/turnout_1'
          message:
            outflow: 10.0
        - time: 5400 # 1.5 hours in - Increase terminal user demand
          topic: 'disturbance/terminal_user'
          message:
            outflow: 20.0
        # --- The following faults are not supported by the current agent implementations ---
        # - time: 3600 # 1 hour in
        #   topic: 'disturbance/inflow'
        #   message:
        #     value: 75.0 # Increase inflow
        # - time: 6300
        #   topic: 'fault/sensor/canal_1_water_level'
        #   message:
        #     is_faulty: true
        #     faulty_value: 5.5
        # - time: 7200
        #   topic: 'fault/actuator/gate_2'
        #   message:
        #     is_faulty: true
        #     faulty_value: 0.3

  - id: gate1_dd_controller
    class: core_lib.local_agents.control.structured_control_agent.StructuredControlAgent
    config:
      controlled_element_id: 'gate_1'
      actuator_topic: 'actuator/gate_1/opening'
      observation_topic: 'sensor/canal_1/water_level'
      control_mode: 'dd'
      controller_config:
        Kp: 0.5
        Ki: 0.05
        Kd: 0.1
        setpoint: 5.0
        min_output: 0.0
        max_output: 1.0

  - id: gate2_lu_controller
    class: core_lib.local_agents.control.structured_control_agent.StructuredControlAgent
    config:
      controlled_element_id: 'gate_2'
      actuator_topic: 'actuator/gate_2/opening'
      observation_topic: 'sensor/canal_2/water_level'
      control_mode: 'lu'
      controller_config:
        Kp: 0.6
        Ki: 0.07
        Kd: 0.1
        setpoint: 5.0
        min_output: 0.0
        max_output: 1.0
