# Mission Example 1 - 物理模型仿真

## 概述

本示例演示纯物理组件（渠道和闸门）的动态行为，展示了水力系统中渠道水位和闸门出流对入流变化的响应。该示例已重构为集成通用调试工具库，提供两种运行方式。

## 功能特性

### 物理模型
- **渠道模型**: 使用UnifiedCanal组件，支持梯形横截面
- **闸门模型**: 使用Gate组件，模拟可控闸门的水力特性
- **动态仿真**: 手动控制的仿真循环，精确计算水位和流量变化

### 集成的调试工具
- **日志管理**: 完整的仿真过程日志记录
- **性能监控**: 仿真步骤和总体性能统计
- **数据收集**: 关键仿真数据的自动收集和存储
- **结果验证**: 自动验证仿真结果的正确性

## 运行方式

### 方式一：硬编码方式

```bash
# 使用硬编码参数运行
python run_hardcoded.py
```

**特点**:
- 参数直接在代码中定义
- 代码逻辑清晰，适合学习和理解
- 快速测试和演示
- 完整集成调试工具

**适用场景**: 学习代码逻辑、快速原型验证

### 方式二：场景运行方式

```bash
# 交互式选择场景
python run_scenario.py

# 直接指定场景编号
python run_scenario.py 1  # 基础物理模型仿真
python run_scenario.py 2  # 物理IO智能体演示
python run_scenario.py 3  # 闸门控制智能体演示
python run_scenario.py 4  # 数字孪生智能体演示
python run_scenario.py 5  # 中央调度智能体演示
```

**特点**:
- 使用传统的多配置文件方式（agents.yml、components.yml、config.yml等）
- 支持交互式场景选择
- 每个场景独立配置
- 灵活的参数调整

**适用场景**: 传统配置管理、多场景对比测试

### 方式三：统一场景运行方式

```bash
# 交互式选择场景
python run_unified_scenario.py

# 直接指定场景编号
python run_unified_scenario.py 1  # 基础物理模型仿真
python run_unified_scenario.py 2  # 物理IO智能体演示
python run_unified_scenario.py 3  # 闸门控制智能体演示
python run_unified_scenario.py 4  # 数字孪生智能体演示
python run_unified_scenario.py 5  # 中央调度智能体演示
```

**特点**:
- 使用统一配置文件（universal_config_1_x.yml）
- 简化的配置管理
- 支持交互式场景选择
- 自动配置文件查找和回退

**适用场景**: 简化配置管理、标准化仿真流程

### 方式四：通用配置运行方式（推荐）

```bash
# 使用通用配置文件运行
python run_universal_config.py
```

**特点**:
- 使用最完整的通用配置文件（universal_config.yml）
- 支持所有高级功能（调试、性能监控、可视化等）
- 参数通过 YAML 配置文件定义
- 代码简洁，易于维护
- 自动验证和分析功能
- 支持进度显示和结果总结

**适用场景**: 生产环境、完整功能测试、性能分析

### 传统配置文件驱动方式（兼容性）

```bash
# 基础物理模型仿真
python run_config.py

# 物理IO智能体演示
python run_config_1_2.py

# 闸门控制智能体演示
python run_config_1_3.py

# 数字孪生智能体演示
python run_config_1_4.py

# 中央调度智能体演示
python run_config_1_5.py
```

**特点**:
- 保持向后兼容性
- 每个场景独立的运行脚本
- 传统的配置文件结构

## 配置文件

每个示例都有对应的 YAML 配置文件：

- `config.yml` - 基础物理模型仿真
- `config_1_2.yml` - 物理IO智能体演示
- `config_1_3.yml` - 闸门控制智能体演示
- `config_1_4.yml` - 数字孪生智能体演示
- `config_1_5.yml` - 中央调度智能体演示

### 主要配置参数

#### 仿真配置
- **duration**: 仿真持续时间
- **dt**: 时间步长
- **description**: 仿真描述

#### 物理组件
- **渠道参数**: 几何尺寸、水力参数
- **闸门参数**: 流量系数、开度设置
- **初始状态**: 水位、流量等初始值

#### 智能体配置
- **PID控制器**: Kp、Ki、Kd参数和设定点
- **数字孪生**: 平滑参数和认知配置
- **中央调度**: MPC参数和优化权重

#### 验证和输出
- **自动验证**: 结果验证标准
- **数据输出**: 日志和历史数据保存

## 输出结果

### 控制台输出
- 🚀 仿真启动信息和配置摘要
- 📊 实时仿真进度条和状态显示
- 🎯 智能体行为和控制动作
- ✅ 自动验证结果和性能指标
- 📈 仿真总结和统计数据

### 数据文件
- **历史数据**: `simulation_history.yml` - 完整的仿真历史记录
- **日志文件**: 详细的运行日志和调试信息
- **验证报告**: 自动生成的结果验证报告

## 验证标准

每个示例都有特定的验证标准：

1. **基础物理模型**: 水位和流量响应的物理合理性
2. **物理IO智能体**: 传感器读取和执行器控制的准确性
3. **闸门控制智能体**: PID控制器的稳定性和响应性能
4. **数字孪生智能体**: 数据平滑和异常检测能力
5. **中央调度智能体**: MPC优化和调度指令的合理性

## 文件结构

```
mission/example_1/
├── README.md                    # 本文档
├── config.yml                   # 基础物理模型配置
├── config_1_2.yml              # 物理IO智能体配置
├── config_1_3.yml              # 闸门控制智能体配置
├── config_1_4.yml              # 数字孪生智能体配置
├── config_1_5.yml              # 中央调度智能体配置
├── universal_config.yml         # 通用配置文件
├── universal_config_1_2.yml     # 物理IO智能体通用配置
├── universal_config_1_3.yml     # 闸门控制智能体通用配置
├── universal_config_1_4.yml     # 数字孪生智能体通用配置
├── universal_config_1_5.yml     # 中央调度智能体通用配置
├── run_hardcoded.py            # 硬编码方式运行脚本
├── run_scenario.py             # 场景运行方式脚本
├── run_unified_scenario.py     # 统一场景运行方式脚本
├── run_universal_config.py     # 通用配置运行方式脚本
├── run_config.py               # 基础物理模型运行脚本（兼容性）
├── run_config_1_2.py           # 物理IO智能体运行脚本（兼容性）
├── run_config_1_3.py           # 闸门控制智能体运行脚本（兼容性）
├── run_config_1_4.py           # 数字孪生智能体运行脚本（兼容性）
├── run_config_1_5.py           # 中央调度智能体运行脚本（兼容性）
├── 01_basic_simulation/         # 基础物理模型仿真场景
├── 02_advanced_control/         # 物理IO智能体演示场景
├── 03_fault_tolerance/          # 闸门控制智能体演示场景
├── 04_digital_twin_advanced/    # 数字孪生智能体演示场景
└── 05_central_mpc_dispatcher/   # 中央调度智能体演示场景
```

## 技术特性

- **统一架构**: 使用 `run_unified_scenario` 统一仿真运行器
- **配置驱动**: 所有参数通过 YAML 配置文件管理
- **自动验证**: 内置结果验证和分析功能
- **进度显示**: 实时仿真进度和状态监控
- **易于扩展**: 模块化设计，便于添加新功能
```

## 依赖要求

- Python 3.7+
- 项目核心库 (`core_lib`)
- 通用调试工具库

## 使用建议

1. **学习目的**: 使用硬编码方式，代码逻辑更清晰
2. **参数研究**: 使用配置文件方式，便于批量实验
3. **调试分析**: 查看日志文件和调试数据了解详细执行过程
4. **性能优化**: 关注性能统计数据识别瓶颈

## 扩展建议

- 添加更多物理组件（如泵站、水库）
- 实现闸门的动态控制策略
- 增加可视化输出（图表、动画）
- 集成实时数据源