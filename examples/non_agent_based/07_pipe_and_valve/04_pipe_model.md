# 物理模型: 管道 (Pipe)

`管道` (Pipe) 模型用于模拟水在承压管道中的流动。它连接水系统中的两个节点，并根据它们之间的水头差计算流量。

## 物理原理

该模型使用简化形式的 **达西-韦斯巴赫方程** (Darcy-Weisbach equation) 来关联水头损失与流量。管道中由摩擦引起的水头损失 ($H_f$) 由以下公式给出：

$H_f = f \frac{L}{D} \frac{V^2}{2g}$

其中:
- $f$ 是达西摩擦系数。
- $L$ 是管道的长度。
- $D$ 是管道的直径。
- $V$ 是水的平均速度。
- $g$ 是重力加速度。

由于流量 $Q = V \cdot A$ (其中 $A$ 是横截面积)，我们可以重新整理方程以求解 $Q$：

$Q = A \sqrt{\frac{2 g D H_f}{f L}}$

为了方便仿真计算，我们预先计算一个`流量系数` ($C$)，该系数整合了所有恒定的物理参数：

$C = A \sqrt{\frac{2 g D}{f L}}$

这将每个仿真步骤中的流量计算简化为：

$Q = C \sqrt{H_f}$

该模型假设水流为湍流，并且在一个时间步内达到稳定状态。目前，它不考虑反向流动；如果下游水头高于上游水头，则流量设置为零。

## 状态与参数

### 状态

-   `flow` (m³/s): 计算出的通过管道的流量。
-   `outflow` (m³/s): 与 `flow` 相同。这是下游组件使用的值。
-   `head_loss` (m): 上游和下游水头之间的差值。

### 参数

在创建一个 `Pipe` 实例时，您必须提供一个包含以下内容的 `params` 字典：
-   `length` (m): 管道的长度。
-   `diameter` (m): 管道的内径。
-   `friction_factor` (无量纲): 管道材料的达西摩擦系数 (例如，铸铁的典型值为 `0.02`)。

## 使用示例

以下是如何创建一个 `Pipe` 实例：

```python
pipe = Pipe(
    pipe_id="pipe1",
    initial_state={'flow': 0},
    params={
        'length': 1000,  # 1公里
        'diameter': 1.5, # 米
        'friction_factor': 0.02
    }
)
```

在 `SimulationHarness` (仿真平台) 中，`Pipe` 的 `step()` 方法被调用时，会传入一个 `action` 字典，该字典必须包含 `upstream_head` 和 `downstream_head`，这两个值由仿真平台根据相连的组件计算得出。
