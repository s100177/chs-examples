# 示例 6: 传感器扰动下的 PID 控制 (重构版)

## 1. 场景目标

本示例旨在演示**传感器噪声**对闭环控制系统稳定性的影响。

我们复用了“示例3：进水泵PID控制”的基本场景，但在控制器获取水位的“感知”环节引入了扰动。控制器将基于一个**带噪声的、不准确的**水位读数来进行决策，这会导致其控制效果变差，产生超调和持续震荡。

## 2. 架构设计

本场景严格遵循了用户“**必须使用 `PhysicalIOAgent`**”的指令来模拟传感器。

### 核心数据流

1.  **真实水位**: `Reservoir` 组件中存储着每个时刻最真实的物理状态。
2.  **感知与加噪**:
    -   `PhysicalIOAgent`: 作为**带噪声的传感器**，它直接读取 `Reservoir` 的真实水位，在内部加入一个标准差为 0.25 的高斯白噪声，然后将这个“被污染”的读数发布到 `noisy_water_level_topic`。
    -   `DigitalTwinAgent`: **仅用于记录目的**，它也读取真实水位，但发布的是未经处理的“干净”数据到 `true_water_level_topic`，方便我们事后对比。
3.  **错误决策**:
    -   `LocalControlAgent` (PID控制器) 订阅的是 `noisy_water_level_topic`。因此，它的所有决策都是基于不准确的信息。
4.  **执行**:
    -   后续的 `SignalAggregatorAgent` 和 `Reservoir` 的工作流程与示例3完全相同。

这个架构清晰地分离了“真实世界”、“带噪感知”和“控制决策”，是分析此类问题的标准模式。

## 3. 如何运行

在项目根目录下执行以下命令：

```bash
python run_scenario.py examples/watertank_refactored/06_sensor_disturbance
```

## 4. 预期结果

仿真结束后，将在本目录下生成 `output.yml` 文件。

您可以重点观察和对比以下两个主题的数据：

-   `true_water_level_topic`: “干净”的真实水位。
-   `noisy_water_level_topic`: “带噪声”的感知读数。

您会发现，PID控制器为了努力让“带噪声”的读数稳定在目标值 10.0m，其输出的控制指令会频繁波动，导致“干净”的真实水位在10.0m上下产生持续的震荡，并且可能出现明显的超调，直观地展示了传感器噪声对控制系统性能的负面影响。
