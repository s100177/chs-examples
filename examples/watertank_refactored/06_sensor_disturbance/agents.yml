# This file configures all agents for the sensor disturbance scenario.
# It uses the enhanced core PhysicalIOAgent to simulate a noisy sensor.

agents:
  # Agent 1: The Disturbance Agent.
  - id: disturbance_agent
    class: core_lib.data_access.csv_inflow_agent.CsvInflowAgent
    config:
      csv_file: disturbance.csv
      time_column: time
      data_column: outflow_rate
      inflow_topic: disturbance_signal_topic
      data_id: disturbance_1

  # Agent 2: The PID Controller.
  - id: pump_pid_controller_agent
    class: core_lib.local_agents.control.local_control_agent.LocalControlAgent
    config:
      observation_topic: noisy_water_level_topic # Subscribes to the noisy signal
      observation_key: water_level # PhysicalIOAgent publishes a dict with this key
      action_topic: control_signal_topic
      dt: 1.0
      controller:
        class: core_lib.local_agents.control.pid_controller.PIDController
        config:
          setpoint: 10.0
          Kp: 1.2
          Ki: 0.1
          Kd: 0.05
          min_output: 0.0
          max_output: 5.0

  # Agent 3: The Signal Aggregator (now from the core library).
  - id: inflow_aggregator_agent
    class: core_lib.local_agents.utility.signal_aggregator_agent.SignalAggregatorAgent
    config:
      input_configs:
        - topic: control_signal_topic
          key: control_signal
        - topic: disturbance_signal_topic
          key: inflow_rate
      output_topic: aggregated_inflow_topic

  # Agent 4: The Physical I/O Agent, simulating a noisy sensor.
  - id: pio_agent
    class: core_lib.local_agents.io.physical_io_agent.PhysicalIOAgent
    config:
      actuators_config: {}
      sensors_config:
        water_level_sensor_1:
          obj_id: reservoir_1
          state_key: 'water_level'
          topic: noisy_water_level_topic
          noise_std: 0.25

  # Agent 5: A standard Digital Twin Agent for logging the clean signal.
  - id: clean_sensor_logger
    class: core_lib.local_agents.perception.digital_twin_agent.DigitalTwinAgent
    config:
      simulated_object_id: reservoir_1
      state_topic: true_water_level_topic
      log_data: True
